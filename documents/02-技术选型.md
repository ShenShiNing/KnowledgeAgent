# KnowledgeAgent 技术选型文档

## 1. 前端技术栈

### 1.1 框架选择
| 技术选型 | 选型理由 |
|---------|---------|
| **React 19.2.0** | 成熟稳定，生态丰富，组件化开发，配合现有 shadcn/ui 组件库 |
| **Vite 7.2.4** | 开发体验优秀，HMR 快速，构建速度快 |
| **TypeScript 5.9** | 类型安全，提升代码质量和维护性 |

### 1.2 UI 组件库
| 技术选型 | 选型理由 |
|---------|---------|
| **shadcn/ui** | 基于 Radix UI 和 Tailwind CSS，组件质量高，可定制性强 |
| **Tailwind CSS 4.1** | 原子化 CSS，开发效率高，构建体积小 |
| **Lucide React** | 轻量级图标库，图标风格统一 |

---

## 2. 后端技术栈

### 2.1 运行时与框架
| 技术选型 | 选型理由 |
|---------|---------|
| **Bun v1.3+** | 运行速度快，兼容 Node.js 生态，内置包管理器 |
| **Express 5.2** | 成熟稳定的 Node.js/Bun Web 框架，中间件生态丰富 |

### 2.2 数据库
| 技术选型 | 选型理由 |
|---------|---------|
| **MySQL 8.0+** | 成熟稳定，支持 JSON 类型，适合结构化数据存储 |
| **Drizzle ORM** | 类型安全的 ORM，性能优秀，支持 TypeScript |

### 2.3 向量数据库（可选）
| 技术选型 | 选型理由 |
|---------|---------|
| **Qdrant** | 开源高性能向量数据库，支持过滤和混合检索 |
| **Pgvector** | PostgreSQL 扩展，如使用 PostgreSQL 则推荐 |
| **Chroma** | 轻量级向量数据库，易于部署 |

---

## 3. AI/LLM 集成

### 3.1 LLM 接入
| 技术选型 | 选型理由 |
|---------|---------|
| **OpenRouter** | 统一 API 接口，支持多家 LLM 提供商 |
| **直连 API** | OpenAI、Anthropic、阿里通义千问、智谱等 |

### 3.2 文档解析
| 技术选型 | 用途 |
|---------|------|
| **LangChain** | 文档加载器生态丰富，支持多种格式 |
| **Mammoth.js** | 解析 Word (.docx) 文档 |
| **SheetJS (xlsx)** | 解析 Excel 文档 |
| **PDF.js** | 解析 PDF 文档 |
| **Tesseract.js** | OCR 文字识别（浏览器端）|
| **PaddleOCR** | OCR 文字识别（服务端，精度更高）|

### 3.3 向量化
| 技术选型 | 选型理由 |
|---------|---------|
| **OpenAI Embeddings** | 质量高，多语言支持好 |
| **本地模型** | 可使用开源模型（如 sentence-transformers）|

---

## 4. 文档处理技术

### 4.1 文档分块策略
| 策略 | 说明 |
|------|------|
| 按字符数分割 | 固定大小分块 |
| 按段落分割 | 保持语义完整性 |
| 按标题分割 | 基于文档结构分块 |
| 递归分割 | 结合多种策略的递归分块 |

### 4.2 支持的文件格式

| 格式类型 | 扩展名 | 解析技术 |
|---------|--------|---------|
| 文档 | .doc, .docx | Mammoth.js / LibreOffice |
| 表格 | .xls, .xlsx | SheetJS / LibreOffice |
| 演示 | .ppt, .pptx | PptxGenJS / LibreOffice |
| PDF | .pdf | PDF.js / PyMuPDF |
| 纯文本 | .txt, .md | 原生读取 |
| 数据 | .csv, .json | 原生解析 |
| 图片 | .jpg, .png | OCR (Tesseract / PaddleOCR) |

---

## 5. 部署方案

| 组件 | 部署方案 |
|------|----------|
| 前端 | Vercel / Netlify / Docker + Nginx |
| 后端 | Docker / Railway / Railway / Railway / Fly.io |
| 数据库 | 云数据库（阿里云 RDS、腾讯云、Supabase）|
| 向量数据库 | 自部署 Qdrant / 云服务（Pinecone、Weaviate）|

---

## 6. 技术架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                           前端层                                  │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐       │
│  │   React 19    │  │  Vite + HMR   │  │  shadcn/ui    │       │
│  └───────────────┘  └───────────────┘  └───────────────┘       │
└─────────────────────────────────────────────────────────────────┘
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                           网关层                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                   Express + Bun                           │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                           业务层                                  │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐      │
│  │ 文档管理  │  │ 检索服务  │  │ AI对话   │  │ 用户管理  │      │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘      │
└─────────────────────────────────────────────────────────────────┘
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                          数据层                                   │
│  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐   │
│  │   MySQL   │  │  Qdrant   │  │  文件存储  │  │   Redis   │   │
│  │ (结构化)  │  │  (向量)   │  │ (对象存储) │  │  (缓存)   │   │
│  └───────────┘  └───────────┘  └───────────┘  └───────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                          AI 层                                    │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐      │
│  │  OpenAI  │  │Anthropic │  │ 通义千问  │  │  智谱AI  │      │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘      │
└─────────────────────────────────────────────────────────────────┘
```

---

## 7. 技术选型对比

### 7.1 ORM 对比
| ORM | 优点 | 缺点 | 选择 |
|-----|------|------|------|
| Drizzle | 类型安全、性能优秀、API 现代 | 相对较新 | ✅ |
| Prisma | 功能丰富、开发体验好 | 性能略低、依赖重 | - |
| TypeORM | 功能强大 | 代码冗余、类型推断弱 | - |

### 7.2 向量数据库对比
| 数据库 | 优点 | 缺点 | 选择 |
|--------|------|------|------|
| Qdrant | 高性能、易部署、过滤能力强 | 社区相对较小 | ✅ |
| Pinecone | 托管服务、稳定性好 | 价格较高 | - |
| Milvus | 功能强大 | 部署复杂 | - |

---

## 8. 关键技术决策

1. **使用 Bun 作为运行时**：相比 Node.js 有更好的性能，同时保持 API 兼容性
2. **使用 Drizzle ORM**：类型安全是主要考虑，配合 TypeScript 能极大减少运行时错误
3. **使用 OpenRouter 作为统一接入层**：便于扩展支持更多 LLM 提供商
4. **使用 LangChain 的 Document Loaders**：生态丰富，减少自研工作量
5. **前端使用 React + shadcn/ui**：组件化开发，界面一致性好

---

## 9. 待定技术

| 技术点 | 备选方案 | 决策时机 |
|--------|---------|---------|
| 文件存储 | 本地 / OSS / S3 | 系统部署阶段 |
| 实时通信 | SSE / WebSocket | 需要多轮对话时 |
| 鉴权方式 | JWT / Session | 用户登录模块开发时 |
| 向量数据库 | Qdrant / Pgvector / Chroma | 数据规模扩大时 |
