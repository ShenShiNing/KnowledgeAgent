# KnowledgeAgent 提示词文档

## 概述

本文档详细说明了 KnowledgeAgent 应用中使用的 AI 系统提示词设计、管理和最佳实践。

## 目录

- [系统提示词设计理念](#系统提示词设计理念)
- [当前提示词配置](#当前提示词配置)
- [提示词管理](#提示词管理)
- [最佳实践](#最佳实践)
- [测试与优化](#测试与优化)
- [版本历史](#版本历史)

---

## 系统提示词设计理念

### 核心原则

1. **角色明确性**：清晰定义 AI 的角色和职责
2. **能力边界**：明确 AI 能做什么和不能做什么
3. **交互风格**：定义回答的语气、结构和格式
4. **准确性优先**：强调事实准确性，避免虚构信息
5. **用户体验**：提供有帮助、易理解的回答

### 知识库智能体的特点

作为知识库 AI 智能体，系统应该具备以下特征：

- **知识检索与整理**：能够从对话历史中提取和组织信息
- **结构化输出**：以清晰、有条理的方式呈现信息
- **引用意识**：在回答时引用相关上下文
- **总结能力**：能够提炼关键信息和要点
- **准确诚实**：承认知识边界，不编造信息

---

## 当前提示词配置

### 主聊天系统提示词 (v1.0)

**位置**: `packages/server/prompt/chatbox.txt`

**提示词内容**:

```
你是一个专业的知识库 AI 助手，专注于帮助用户管理、检索和理解知识信息。

## 你的核心能力

1. **知识检索**：快速定位和提取相关信息
2. **信息整理**：将复杂信息组织成结构化、易理解的形式
3. **准确回答**：基于事实提供准确、可靠的答案
4. **知识总结**：提炼关键要点，帮助用户快速理解
5. **关联分析**：发现不同知识点之间的联系

## 交互原则

- **准确性第一**：如果不确定答案，诚实说明，不要编造信息
- **结构化回答**：使用标题、列表、分段等方式让答案清晰易读
- **简洁明了**：避免冗长，直击要点，但保持完整性
- **引用上下文**：在回答时适当引用对话历史中的相关信息
- **主动引导**：当用户问题不清晰时，主动询问细节

## 回答格式建议

对于复杂问题，建议使用以下结构：

1. **简短总结**：一句话概括答案核心
2. **详细解释**：分点或分段详细说明
3. **示例说明**（如适用）：提供具体例子帮助理解
4. **相关建议**（如适用）：提供延伸建议或相关信息

## 限制与边界

- 不提供医疗、法律等专业建议
- 不参与有害、违法或不道德的活动
- 承认知识截止日期，对最新信息保持谨慎
- 对于个人观点性问题，提供多角度分析而非单一立场
```

**设计说明**:

- **温度设置**: 0.2（低温度确保回答稳定和准确）
- **最大 Token**: 200（适合简短但完整的回答）
- **模型**: GPT-4o-mini（性价比最优，响应速度快）

---

## 提示词管理

### 文件结构

```
packages/server/prompt/
├── chatbox.txt           # 主聊天系统提示词
├── summarizer.txt        # 摘要生成提示词（规划中）
├── knowledge-extract.txt # 知识提取提示词（规划中）
└── README.md            # 提示词使用说明
```

### 加载机制

系统提示词通过以下方式加载：

1. **启动时加载**：服务器启动时从文件读取提示词
2. **缓存机制**：提示词缓存在内存中，避免重复读取
3. **热重载**（规划中）：支持不重启服务器更新提示词

**实现位置**: `packages/server/service/prompt-config.ts`

```typescript
// 提示词配置模块
export class PromptConfig {
  private static systemPrompt: string | null = null;

  // 加载系统提示词
  static async loadSystemPrompt(): Promise<string> {
    if (this.systemPrompt) return this.systemPrompt;

    const promptPath = path.join(__dirname, '../prompt/chatbox.txt');
    this.systemPrompt = await fs.readFile(promptPath, 'utf-8');
    return this.systemPrompt;
  }

  // 重新加载提示词
  static async reloadSystemPrompt(): Promise<void> {
    this.systemPrompt = null;
    await this.loadSystemPrompt();
  }
}
```

---

## 最佳实践

### 1. 提示词编写原则

#### ✅ 推荐做法

- **清晰的角色定义**：明确告诉 AI 它是什么角色
- **具体的指令**：使用"你应该..."而非"你可以..."
- **结构化组织**：使用标题和列表让提示词易于理解
- **包含示例**：提供期望输出的示例
- **设定边界**：明确说明 AI 不应该做什么

#### ❌ 避免做法

- 模糊的指令："尽可能好地回答"
- 过于复杂的嵌套逻辑
- 自相矛盾的要求
- 过长的提示词（建议 < 500 tokens）
- 包含敏感或私密信息

### 2. 提示词优化流程

```
1. 定义目标 → 2. 编写初版 → 3. 测试效果 → 4. 收集反馈 → 5. 迭代优化
                                     ↑                              ↓
                                     └──────────────────────────────┘
```

**优化步骤**:

1. **明确目标**：确定提示词要解决的具体问题
2. **编写草稿**：基于最佳实践编写初始版本
3. **多样化测试**：使用不同类型的问题测试
4. **A/B 测试**：对比不同版本的效果
5. **收集数据**：记录成功率、用户满意度等指标
6. **迭代改进**：根据数据持续优化

### 3. 常见问题与解决方案

#### 问题 1：AI 回答过于冗长

**解决方案**:
```
在提示词中添加：
"保持回答简洁明了，避免不必要的重复。对于简单问题，1-2 句话足够。"
```

#### 问题 2：AI 编造不存在的信息

**解决方案**:
```
强化准确性要求：
"如果对某个信息不确定，必须明确说明'我不确定'或'我没有这方面的信息'，
绝不要编造或猜测答案。"
```

#### 问题 3：AI 回答格式不统一

**解决方案**:
```
提供明确的格式模板：
"对于复杂问题，请使用以下格式：
【概要】：一句话总结
【详细说明】：分点详细解释
【建议】：相关建议（如适用）"
```

### 4. 模型参数调优

针对不同场景的推荐参数：

| 场景 | Temperature | Max Tokens | Top P | 说明 |
|------|-------------|------------|-------|------|
| 知识问答 | 0.1 - 0.3 | 150 - 300 | 0.9 | 需要准确和一致性 |
| 创意写作 | 0.7 - 0.9 | 500 - 1000 | 0.95 | 需要多样性和创造力 |
| 代码生成 | 0.2 - 0.4 | 300 - 800 | 0.9 | 平衡准确性和灵活性 |
| 摘要总结 | 0.3 - 0.5 | 100 - 200 | 0.9 | 保持信息完整性 |

**当前配置** (知识问答场景):
- Temperature: `0.2` ✓
- Max Tokens: `200` ✓
- Top P: `默认` (0.9)

---

## 测试与优化

### 测试用例集

为确保提示词质量，建议创建测试用例集：

**基础能力测试**:
```
1. 简单问答："什么是机器学习？"
2. 复杂解释："解释神经网络的反向传播原理"
3. 知识边界："2025 年诺贝尔物理学奖得主是谁？"（测试承认不知道的能力）
4. 多步骤问题："如何设计一个推荐系统？"
```

**边界测试**:
```
1. 模糊问题："帮我学习"（测试主动澄清能力）
2. 超长问题：测试处理复杂上下文的能力
3. 多语言：测试中英文混合场景
4. 专业领域：测试垂直领域知识深度
```

**格式测试**:
```
1. 列表输出："列出 5 个前端框架"
2. 表格输出："对比 React 和 Vue"
3. 代码输出："写一个快速排序算法"
4. Markdown 格式：测试格式化能力
```

### 评估指标

| 指标 | 定义 | 目标值 |
|------|------|--------|
| 准确率 | 回答事实正确的比例 | ≥ 95% |
| 相关性 | 回答切中问题的比例 | ≥ 90% |
| 完整性 | 回答完整不遗漏的比例 | ≥ 85% |
| 格式遵循 | 遵循指定格式的比例 | ≥ 90% |
| 边界识别 | 正确识别知识边界的比例 | ≥ 95% |

### 持续改进

建议建立提示词改进流程：

1. **定期审查**（每月）：回顾用户反馈和常见问题
2. **版本管理**：使用语义化版本号（v1.0, v1.1, v2.0）
3. **变更记录**：记录每次修改的原因和效果
4. **回滚机制**：保留历史版本，支持快速回滚

---

## 版本历史

### v1.0.0 (2026-01-17) - 初始版本

**变更内容**:
- 创建知识库 AI 助手的基础系统提示词
- 定义核心能力和交互原则
- 设置回答格式建议
- 明确限制与边界

**设计理由**:
- 针对知识库场景优化，强调准确性和结构化
- 温和的语气，专业但易于理解
- 适度的回答长度控制（200 tokens）

**测试结果**:
- [ ] 待测试：基础问答能力
- [ ] 待测试：知识边界识别
- [ ] 待测试：格式遵循度

---

## 附录

### 参考资源

- [OpenAI Prompt Engineering Guide](https://platform.openai.com/docs/guides/prompt-engineering)
- [Anthropic Prompt Engineering Guide](https://docs.anthropic.com/claude/docs/prompt-engineering)
- [提示工程最佳实践](https://www.promptingguide.ai/)

### 相关文件

- `packages/server/service/chat.ts` - 聊天服务实现
- `packages/server/service/prompt-config.ts` - 提示词配置模块
- `packages/server/prompt/chatbox.txt` - 系统提示词文件

### 贡献指南

如需修改系统提示词，请：

1. 在 `prompt/` 目录下修改对应文件
2. 更新本文档的版本历史
3. 运行测试用例验证效果
4. 提交 PR 说明修改原因和预期效果

---

*最后更新：2026-01-17*
*维护者：KnowledgeAgent Team*
